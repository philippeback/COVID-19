---
title: "COVID Notebook"
output:
  html_document:
    df_print: paged
  html_notebook: default
---

# Data

https://github.com/CSSEGISandData/COVID-19/tree/master/csse_covid_19_data/csse_covid_19_time_series

We hope we'll soon get proper data from

https://epistat.wiv-isp.be/covid/

At this point, nothing is available.

```{r Sources, echo=TRUE}
sourceConfirmed <- "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv"

sourceDeceased <- "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_global.csv"

sourceRecovered <- "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_recovered_global.csv"

sourceEschnou <- "https://raw.githubusercontent.com/eschnou/covid19-be/master/covid19-belgium.csv"
```

```{r Read Source JH, echo=TRUE}

require(lubridate)
#require(glue)

dataConfirmed <- read.csv(sourceConfirmed)

dataDeceased <- read.csv(sourceDeceased)

dataRecovered <- read.csv(sourceRecovered)


#print(str(dataConfirmed))
#print(str(dataDeceased))
#print(str(dataRecovered))

```

```{r Read Source Eschnou, echo=TRUE}

# Damn UTF-8 BOM...
dataEschnou <- read.csv(sourceEschnou, fileEncoding = "UTF-8-BOM")
# print(str(dataEschnou))

belgiumLatest<-tail(dataEschnou,1)
parsedDate<-parse_date_time(as.character(belgiumLatest$date),c("dmy"))
belgiumLatestDate<-gsub("#0", "", format(parsedDate,"X#%m.%d.%y"))

latestBelgiumColumnConfirmed<-data.frame(belgiumLatest$cumul_cases)
names(latestBelgiumColumnConfirmed)[1] <- belgiumLatestDate

latestBelgiumColumnDeceased<-data.frame(belgiumLatest$cumul_deceased)
names(latestBelgiumColumnDeceased)[1] <- belgiumLatestDate

latestBelgiumColumnRecovered<-data.frame(belgiumLatest$cumul_released)
names(latestBelgiumColumnRecovered)[1] <- belgiumLatestDate


```



```{r echo=TRUE}

country="Belgium"
#country="Netherlands"

dataPointsOfCountry <- function(rawDataset, countryName) {
  dataOfCountry <- rawDataset[rawDataset$Country.Region == country, ]
  dataPointsOfCountry <-  dataOfCountry[,c(5:ncol(dataOfCountry))]
  return(dataPointsOfCountry)
}
  
  
dataPointsConfirmed <- dataPointsOfCountry(dataConfirmed, country)
dataPointsDeceased <-  dataPointsOfCountry(dataDeceased, country)
dataPointsRecovered <- dataPointsOfCountry(dataRecovered, country)


if (country=="Belgium") {
  dataPointsConfirmed <- cbind(dataPointsConfirmed,latestBelgiumColumnConfirmed)
  dataPointsDeceased <- cbind(dataPointsDeceased,latestBelgiumColumnDeceased)
  dataPointsRecovered <- cbind(dataPointsRecovered,latestBelgiumColumnRecovered)
}


cleanDate <- function(s) {
   p<-unlist(strsplit(s,"X|\\."))
   return(paste0(p[3],"/",p[2],"/20",p[4]))
}

```

# Figures

## Linear Figures

```{r Confirmed, echo=TRUE, error=TRUE}

  #plot(xrange,yrange, xlim=xrange, ylim=yrange, main="",
  #       ylab="",type="n", yaxt="n", xaxt="n")
    
  # axis(side = 2, at =ithyPositions, labels = ithyLabels)
    
  #  mtext(itemsubtitle,  side=1, line = -2, adj=0.9, cex=1.1)
    
  #  points(head(ith$breaks, -1), # do not use latest break for proper plotting
  #         -ith$counts,
  #         type="h",       # histogram style
  #         col="blue",     # color of bars
  #         lend=4,         # 
  #         lwd=5)          # line width for drawing symbols
    
  #    mtext(
  #      paste0("Mean Locs:",round(ithMean, digits=3)),
  #      side=1, 
  #      line = -3, 
  #      adj=0.1,
  #      cex=0.6)
  
  #  abline(h=(-max(ith$counts))/2.0,col="blue", lty=3)
  #    axis(1,
  #        at=seq(floor(xrange[1]),ceiling(xrange[2])),
  #        cex.axis=1.0,
  #        padj=-1.5)

ymax <- max(dataPointsConfirmed)
yrange <- c(0, (floor(ymax/1000.0)+1)*1000)
xvalues <- seq_along(dataPointsConfirmed)

plot(
  xvalues,
  dataPointsConfirmed, 
  xlab="days since 22/1/2020", 
  ylab="confirmed cases", 
  main=paste0(
    country, 
    " confirmed COVID-19 cases on ",
    cleanDate(tail(names(dataPointsConfirmed),1))),
  type="l",
  lwd=2,
  col="dark green",
  ylim=yrange)

abline(h=ymax, col="dark green", lty=4)
text(
  tail(xvalues,1)*0.95,
  (ymax * 1.03),
  paste("Max:",ymax),
  cex=0.6)
```


```{r Deceased, echo=TRUE, error=TRUE, message=TRUE, warning=TRUE}
plot(seq_along(dataPointsDeceased),dataPointsDeceased, xlab="days since 22/1/2020", ylab="deceased cases", main=paste0(country," deceased COVID-19 cases on ",cleanDate(tail(names(dataPointsDeceased),1))),type="l",col="dark red")
```
```{r Recovered, echo=TRUE, error=TRUE, message=TRUE, warning=TRUE}
plot(seq_along(dataPointsRecovered),dataPointsRecovered, xlab="days since 22/1/2020", ylab="recovered cases", main=paste0(country," recovered COVID-19 cases on ",cleanDate(tail(names(dataPointsRecovered),1))),type="l",col="orange")
```

## Logarithmic Figures

```{r Confirmed Log, echo=TRUE, error=TRUE}

plot(seq_along(dataPointsConfirmed),log(dataPointsConfirmed), xlab="days since 22/1/2020", ylab="log(confirmed cases)", main=paste0(country, " confirmed COVID-19 cases on ",cleanDate(tail(names(dataPointsConfirmed),1))),type="l",col="dark green")


```


```{r Deceased Log, echo=TRUE, error=TRUE}
plot(seq_along(dataPointsDeceased),log(dataPointsDeceased), xlab="days since 22/1/2020", ylab="log(deceased cases)", main=paste0(country, " deceased COVID-19 cases on ",cleanDate(tail(names(dataPointsDeceased),1))),type="l",col="dark red")
```


```{r Recovered Log, echo=TRUE, error=TRUE}
plot(seq_along(dataPointsRecovered),log(dataPointsRecovered), xlab="days since 22/1/2020", ylab="log(recovered cases)", main=paste0(country, " recovered COVID-19 cases on ",cleanDate(tail(names(dataPointsRecovered),1))),type="l",col="orange")
```